(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{377:function(t,s,a){"use strict";a.r(s);var e=a(10),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"入口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入口"}},[t._v("#")]),t._v(" 入口")]),t._v(" "),s("h2",{attrs:{id:"目录结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[t._v("#")]),t._v(" 目录结构")]),t._v(" "),s("p",[t._v("我们去 github 下载 vue 的源码，主要看 vue 的核心目录结构:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("src\n├── compiler  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 编译")]),t._v("\n├── core      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 核心")]),t._v("\n├── platforms "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 各个平台")]),t._v("\n├── server    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ssr")]),t._v("\n├── sfc       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vue文件处理")]),t._v("\n└── shared    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 共享的工具等")]),t._v("\n")])])]),s("p",[s("code",[t._v("compiler")]),t._v(": 主要是模版编译相关的代码")]),t._v(" "),s("p",[s("code",[t._v("core")]),t._v(": 核心代码，包含内置组件，全局的 api，实例化，响应式，工具函数，虚拟 dom")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("core\n├── components "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 内置组件")]),t._v("\n├── global-api "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 全局 api")]),t._v("\n├── instance "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 实例化")]),t._v("\n├── observer "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 响应式")]),t._v("\n├── util "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工具函数")]),t._v("\n└── vdom "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 虚拟 dom")]),t._v("\n\n")])])]),s("p",[s("code",[t._v("platforms")]),t._v(": 提供了跨平台的能力，区分"),s("code",[t._v("web")]),t._v("和"),s("code",[t._v("weex")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("platforms\n├── web\n├── weex\n\n")])])]),s("p",[s("code",[t._v("server")]),t._v(": "),s("code",[t._v("ssr")]),t._v(" 相关的渲染")]),t._v(" "),s("p",[s("code",[t._v("sfc")]),t._v(": 解析 "),s("code",[t._v("vue")]),t._v(" 文件转为"),s("code",[t._v("js")]),t._v(" 对象")]),t._v(" "),s("p",[s("code",[t._v("shared")]),t._v(": "),s("code",[t._v("web")]),t._v(" 和服务端共享代码")]),t._v(" "),s("p",[t._v("我们从整体看，整个项目主要采用了 rollup 来进行构建，将这些逻辑打包成不同规范的文件。\nvue 的构建一般分为"),s("code",[t._v("带 compiler 版本")]),t._v("和"),s("code",[t._v("不带 compiler 的 runtime 版本")]),t._v("，不带 compiler 的一般是由 webpack 等工具来处理编译的过程，整体的大小会小很多,由于我们在初始化的时候带有 template 标签，所以自然使用带编译的版本来看代码。")]),t._v(" "),s("p",[t._v("我们先看"),s("code",[t._v("package.json")]),t._v("中的"),s("code",[t._v("dev")]),t._v("脚本：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("scripts:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    dev"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('": "')]),t._v("rollup "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-w")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" scripts/config.js "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--sourcemap")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--environment")]),t._v(' TARGET:web-full-dev",\n'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("很清晰的看到传了一个参数"),s("code",[t._v("web-full-cjs-dev")]),t._v(",所以我们直接看"),s("code",[t._v("scripts")]),t._v("目录下的"),s("code",[t._v("config.js")]),t._v("中的某个配置:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v(" web"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("full"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cjs"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("dev'"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'web/entry-runtime-with-compiler.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dest")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/vue.common.dev.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("alias")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("he")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./entity-decoder'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    banner\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这个 entry 就是打包的文件入口，包含了 comipler 的内容,也就是我们要看的第一个文件"),s("code",[t._v("entry-runtime-with-compiler.js")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"从入口开始"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从入口开始"}},[t._v("#")]),t._v(" 从入口开始")]),t._v(" "),s("p",[t._v("一般我们用 vue 进行开发的时候，入口处基本都是类似的语法:")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("el")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#app"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<div>{{message}}</div>"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello vue"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("我们可以看看入口文件"),s("code",[t._v("entry-runtime-with-compiler.js")]),t._v("做了什么：")]),t._v(" "),s("p",[t._v("这个文件主要扩展了"),s("code",[t._v("$mount")]),t._v(" 方法，针对没有传入"),s("code",[t._v("render")]),t._v(" 选项的参数，进行 "),s("code",[t._v("template")]),t._v(" 或 "),s("code",[t._v("el")]),t._v(" 的转化处理，变成新的 "),s("code",[t._v("render")]),t._v(" 函数,最终调用 "),s("code",[t._v("mount")]),t._v("方法挂载 "),s("code",[t._v("dom")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./runtime/index"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 扩展默认的$mount方法")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$mount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("$mount")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("el")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.传入的el不能是body或者html")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.如果不传render，首先会转化template为render函数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("options"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("render"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3.挂载dom")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" el"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" Vue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("1.el 不能是 body 或者 html 标签")]),t._v(" "),s("p",[t._v("2.如果没有 render，会把 template 转换为 render 函数")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("如果有 render 函数，直接调用 mount 方法挂载 dom")])])])}),[],!1,null,null,null);s.default=n.exports}}]);